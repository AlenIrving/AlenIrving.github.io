

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/yuanshen.png">
  <link rel="icon" href="/img/yuanshen.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Ma5k">
  <meta name="keywords" content="">
  
    <meta name="description" content="知识点pyc，tea类加解密，花指令 pyc反编译引言逆向就是逆向应用程序，代码，算法的过程，途中会涉及很多类型的文件基于不同平台生成  不同的exe有不同的逆法，当然可以直接手撕，但效率低很多 而pyc文件则是python代码编译后生成exe的中间产物，所以通常用工具将其还原为python原代码进行逆向 知识点介绍PYC文件格式.pyc文件是python解释器在编译.py文件后生成的二进制文件，">
<meta property="og:type" content="article">
<meta property="og:title" content="Reverse入门参考(二)">
<meta property="og:url" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/index.html">
<meta property="og:site_name" content="Ma5k&#39;s Blog">
<meta property="og:description" content="知识点pyc，tea类加解密，花指令 pyc反编译引言逆向就是逆向应用程序，代码，算法的过程，途中会涉及很多类型的文件基于不同平台生成  不同的exe有不同的逆法，当然可以直接手撕，但效率低很多 而pyc文件则是python代码编译后生成exe的中间产物，所以通常用工具将其还原为python原代码进行逆向 知识点介绍PYC文件格式.pyc文件是python解释器在编译.py文件后生成的二进制文件，">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/1.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/2.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/3.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/4.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/5.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/6.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/7.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/8.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/9.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/10.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/11.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/12.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/13.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/14.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/15.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/16.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/17.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/18.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/19.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/20.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/21.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/22.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/23.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/24.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/25.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/26.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/27.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/28.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/29.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/30.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/31.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/32.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/33.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/34.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/35.png">
<meta property="og:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/36.png">
<meta property="article:published_time" content="2025-07-25T16:00:00.000Z">
<meta property="article:modified_time" content="2025-07-26T13:26:19.143Z">
<meta property="article:author" content="Ma5k">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://alenirving.github.io/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/1.png">
  
  
  
  <title>Reverse入门参考(二) - Ma5k&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"alenirving.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":"oqufArAhMdAIfuSwGcA0SJau-gzGzoHsz","app_key":"MOKJfsXIQuG9dWR5QTE2kRLH","server_url":"https://oqufarah.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":true},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Ma5k&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/GoogleHacking/" target="_self">
                <i class="iconfont fa-google"></i>
                <span>GoogleHacking</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Reverse入门参考(二)"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-07-26 00:00" pubdate>
          2025年7月26日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          6k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          50 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Reverse入门参考(二)</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h1><p>pyc，tea类加解密，花指令</p>
<h1 id="pyc反编译"><a href="#pyc反编译" class="headerlink" title="pyc反编译"></a>pyc反编译</h1><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>逆向就是逆向应用程序，代码，算法的过程，途中会涉及很多类型的文件基于不同平台生成</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/1.png" srcset="/img/loading.gif" lazyload></p>
<p>不同的exe有不同的逆法，当然可以直接手撕，但效率低很多</p>
<p>而pyc文件则是python代码编译后生成exe的中间产物，所以通常用工具将其还原为python原代码进行逆向</p>
<h2 id="知识点介绍"><a href="#知识点介绍" class="headerlink" title="知识点介绍"></a>知识点介绍</h2><h3 id="PYC文件格式"><a href="#PYC文件格式" class="headerlink" title="PYC文件格式"></a>PYC文件格式</h3><p>.pyc文件是python解释器在编译.py文件后生成的二进制文件，其格式类似于java的.class文件，具有跨平台性。.pyc文件包含Python字节码，这些字节码是由Python虚拟机执行的，与Java或.NET的虚拟机概念相似，实现了跨平台运行。.pyc文件的生成提高了程序的加载速度，并且它们是pycodeobject对象的持久化保存方式。PyCodeObject是Python完全面向对象语言在解释器中解释执行时生成的对象。当Python程序运行结束时，解释器会将PyCodeObject写回到.pyc文件中，以便下次运行时可以直接加载，提高运行效率。</p>
<p>.pyc文件的基本格式包括：</p>
<ul>
<li>一个<a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=Magic%20int&rsv_idx=2&tn=baiduhome_pg&usm=2&ie=utf-8&rsv_pq=e184d3af00081af7&oq=pyc%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F&rsv_t=4ce8p1nrYiaD0A9YmnmciqnmPZkqBYQUWK8RG5vvjXDBkXAWtKNRY9h/MA0iNr2116nj&sa=re_dqa_zy&icon=1"><strong><font style="color:rgb(51, 51, 51);">Magic int</font></strong></a>，标识pyc的版本信息。</li>
<li>一个int，表示pyc产生的时间（从1970年1月1日到产生pyc时的秒数）。</li>
<li>一个序列化的PyCodeObject，包含Python代码的字节码表示。</li>
</ul>
<p>PyCodeObject的序列化过程涉及写入不同类型的PyObject，每种PyObject都有一个标识其类型的<a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=byte&rsv_idx=2&tn=baiduhome_pg&usm=2&ie=utf-8&rsv_pq=e184d3af00081af7&oq=pyc%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F&rsv_t=4ce8p1nrYiaD0A9YmnmciqnmPZkqBYQUWK8RG5vvjXDBkXAWtKNRY9h/MA0iNr2116nj&sa=re_dqa_zy&icon=1"><strong><font style="color:rgb(51, 51, 51);">byte</font></strong></a>，以及PyObject的具体数据内容。例如，变长对象（如str, tuple, list等）通常还包含一个4字节的长度。</p>
<p>此外，Python提供了优化编译的选项，如-O用于生成优化的字节码文件.pyo，而-m用于导入并运行指定的模块，生成.pyc文件。这些优化对于减少嵌入式系统的容量需求或提高程序运行效率是有益的。</p>
<h3 id="4个字节的Magic-number"><a href="#4个字节的Magic-number" class="headerlink" title="4个字节的Magic number "></a><strong>4个字节的</strong><strong><font style="color:rgb(51, 51, 51);">Magic number </font></strong></h3><p>魔数介绍：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39787628/article/details/110835123">python magic number_编程中的「魔数」（magic number）是什么意思？平时我们能接触到哪些魔数？…-CSDN博客</a></p>
<p>各版本魔术头：<a target="_blank" rel="noopener" href="https://blog.csdn.net/OrientalGlass/article/details/134612786">Python逆向全版本MagicNumber表_python magic number-CSDN博客</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python">enum PycMagic &#123;<br>    MAGIC_1_0 = <span class="hljs-number">0x00999902</span>,<br>    MAGIC_1_1 = <span class="hljs-number">0x00999903</span>, /* Also covers <span class="hljs-number">1.2</span> */<br>    MAGIC_1_3 = <span class="hljs-number">0x0A0D2E89</span>,<br>    MAGIC_1_4 = <span class="hljs-number">0x0A0D1704</span>,<br>    MAGIC_1_5 = <span class="hljs-number">0x0A0D4E99</span>,<br>    MAGIC_1_6 = <span class="hljs-number">0x0A0DC4FC</span>,<br> <br>    MAGIC_2_0 = <span class="hljs-number">0x0A0DC687</span>,<br>    MAGIC_2_1 = <span class="hljs-number">0x0A0DEB2A</span>,<br>    MAGIC_2_2 = <span class="hljs-number">0x0A0DED2D</span>,<br>    MAGIC_2_3 = <span class="hljs-number">0x0A0DF23B</span>,<br>    MAGIC_2_4 = <span class="hljs-number">0x0A0DF26D</span>,<br>    MAGIC_2_5 = <span class="hljs-number">0x0A0DF2B3</span>,<br>    MAGIC_2_6 = <span class="hljs-number">0x0A0DF2D1</span>,<br>    MAGIC_2_7 = <span class="hljs-number">0x0A0DF303</span>,<br> <br>    MAGIC_3_0 = <span class="hljs-number">0x0A0D0C3A</span>,<br>    MAGIC_3_1 = <span class="hljs-number">0x0A0D0C4E</span>,<br>    MAGIC_3_2 = <span class="hljs-number">0x0A0D0C6C</span>,<br>    MAGIC_3_3 = <span class="hljs-number">0x0A0D0C9E</span>,<br>    MAGIC_3_4 = <span class="hljs-number">0x0A0D0CEE</span>,<br>    MAGIC_3_5 = <span class="hljs-number">0x0A0D0D16</span>,<br>    MAGIC_3_5_3 = <span class="hljs-number">0x0A0D0D17</span>,<br>    MAGIC_3_6 = <span class="hljs-number">0x0A0D0D33</span>,<br>    MAGIC_3_7 = <span class="hljs-number">0x0A0D0D42</span>,<br>    MAGIC_3_8 = <span class="hljs-number">0x0A0D0D55</span>,<br>    MAGIC_3_9 = <span class="hljs-number">0x0A0D0D61</span>,<br>    MAGIC_3_10 = <span class="hljs-number">0x0A0D0D6F</span>,<br>    MAGIC_3_11 = <span class="hljs-number">0x0A0D0DA7</span>,<br>    MAGIC_3_12 = <span class="hljs-number">0x0A0D0DCB</span>,<br> <br>    INVALID = <span class="hljs-number">0</span>,<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>遇到魔改题目修改的时候注意调整端序，此处涉及大小端序问题，可自行上网搜索</p>
<h3 id="12-个字节的源代码文件信息"><a href="#12-个字节的源代码文件信息" class="headerlink" title="12 个字节的源代码文件信息"></a><strong><font style="color:rgb(38,38,38);">12 个字节的源代码文件信息</font></strong></h3><p><font style="color:rgb(38,38,38);">（不同版本的 Python 包含的⻓度和信息都不⼀样）</font></p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/2.png" srcset="/img/loading.gif" lazyload></p>
<p>bit field：<font style="color:rgb(51, 51, 51);">位域是指信息在存储时,并不需要占用一个完整的字节,而只需占一个或几个二进制位</font></p>
<p><font style="color:rgb(51, 51, 51);">例如在存放一个开关量时,只有0和1两种状态,用一位二进位即可</font></p>
<p><font style="color:rgb(51, 51, 51);">为了节省存储空间,C语言又提供了一种数据结构,称为”位域”</font></p>
<p><font style="color:rgb(51, 51, 51);">所谓”位域”就是把一个字节中的二进位划分为几个不同的区域,并说明每个区域的位数</font></p>
<p><font style="color:rgb(51, 51, 51);">每个域有一个域名,允许在程序中按域名进行操作</font></p>
<p><font style="color:rgb(51, 51, 51);">这样就可以把几个不同的对象用一个字节的二进制位域来表示</font></p>
<p><font style="color:rgb(51, 51, 51);">比如cpu中的</font><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%A8%8B%E5%BA%8F%E7%8A%B6%E6%80%81%E5%AD%97/0?fromModule=lemma_inlink">程序状态字</a><font style="color:rgb(51, 51, 51);">PSW，字节中不同的位表示不同的状态信息，称位标志位。</font></p>
<h3 id="序列化之后的-PyCodeObject"><a href="#序列化之后的-PyCodeObject" class="headerlink" title="序列化之后的 PyCodeObject"></a><strong><font style="color:rgb(38,38,38);">序列化之后的 PyCodeObject</font></strong></h3><p><font style="color:rgb(51, 51, 51);">PyCodeObject是Python中代码对象的内部表示，它是编译后的Python代码的内部结构。序列化指的是将对象或数据结构转换成可存储或传输的格式的过程。在Python中，你可以使用 pickle 模块来序列化PyCodeObject</font></p>
<p><font style="color:#DF2A3F;">大致流程： .exe –&gt; .pyc –&gt; .py </font><font style="color:rgb(38,38,38);"> </font></p>
<p><font style="color:rgb(38,38,38);">参考链接：</font><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/12546?time__1311=eqUxu7DtD=PmqDKDsuRRBbEx0KGQqdCbq4D&u_atoken=c2be98df2b175a1d2ceb006eef71232d&u_asig=1a0c381017439881621575469e0045">先知社区</a></p>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><p>exe-&gt;pyc 涉及文件 <strong>pyinstxtractor.py</strong></p>
<p>pyc-&gt;py 常见的就 **pycdc **和 **uncompyle6(<strong>python环境自行pip安装</strong>) **，uncompyle6对应python3.8及以下版本，pycdc对应3.8及以上版本，推荐直接使用在线网站反编译</p>
<p>网站链接：<a target="_blank" rel="noopener" href="https://tool.lu/pyc">https://tool.lu/pyc</a></p>
<p>懒人选项： **pydumpck **</p>
<p>参考链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/u012132482/article/details/127131503"><strong>https://blog.csdn.net/u012132482/article/details/127131503</strong></a></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>拿到一个exe文件</p>
<p>开放实验网站原题pymaze</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/3.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/4.png" srcset="/img/loading.gif" lazyload></p>
<p>会在当前目录下生成一个提取的文件夹</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/5.png" srcset="/img/loading.gif" lazyload></p>
<p>找到里面对应exe的pyc文件</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/6.png" srcset="/img/loading.gif" lazyload></p>
<p>使用对应版本工具</p>
<p>eg:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">uncompyle6 pymaze.pyc &gt; <span class="hljs-number">1.</span>py<br>pycdc.exe pymaze.pyc &gt; <span class="hljs-number">2.</span>py<br></code></pre></td></tr></table></figure>

<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/7.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="特殊情况"><a href="#特殊情况" class="headerlink" title="特殊情况"></a>特殊情况</h2><p>exe-&gt;pyc这一步pyinstxtractor.py运行可能会报错，因为python exe文件是基于本地python版本生成的，不同版本会出现兼容问题</p>
<p>解决方法：</p>
<p>1.（不推荐）tips:如果你使用 pyinstxtractor，请在 pyinstxtractor.py 找到 # Skip PYZ extraction if not running under the same python version 然后将它下面五行的 return 注释掉（让 return 不生效）。否则，你运行 pyinstxtractor.py 时使用的 Python 小版本号必须与附件相同。或者，你也可以尝试使用更方便的工具，例如 pydumpck 。</p>
<ol start="2">
<li>使用anaconda管理本地python版本，可根据version的提示创建对应版本虚拟环境<img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/8.png" srcset="/img/loading.gif" lazyload></li>
</ol>
<p>有些题目会遇到py代码里导入相关自定义函数，可以在提取的文件夹里找对应名字的pyc文件反编译成py放入应用程序py文件同一目录下即可</p>
<p>还有些恶心题目无法反编译，需要用到pycdas将pyc文件编译成字节码，分析类似汇编代码</p>
<h2 id="拓展-反编译加密pyc文件"><a href="#拓展-反编译加密pyc文件" class="headerlink" title="拓展(反编译加密pyc文件)"></a>拓展(反编译加密pyc文件)</h2><p>提一嘴(<em>.–.</em>)小插曲</p>
<p>PYD文件: PYD文件是Python的一种拓展模块文件格式，本质上是windows动态链接库(DLL)，转为Python涉及，</p>
<p>以后的题目会接触到PYD逆向</p>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a><font style="color:rgb(0, 0, 0);">分析</font></h3><p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/9.png" srcset="/img/loading.gif" lazyload></p>
<p><font style="color:rgb(0, 0, 0);">在反编译python生成可执行文件exe时，引用的类库文件经常遇到使用Crypto 模块AES算法加密，解包生成的并不是pyc文件，而是加密的pyc.encrypted文件，此类加密文件无法反编译</font></p>
<p><font style="color:rgb(0, 0, 0);">主要跟pyinstaller生成exe时的操作有关</font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">picture.ico为图标：<br>PyInstaller -F -i picture.ico -n noPac.exe noPac.py<br> <br>打包成独立exe：<br>PyInstaller -F --version-file ver.txt noPac.py<br><span class="hljs-comment"># 多文件</span><br>pyinstaller -D noPac.py<br><span class="hljs-comment"># 单个可执行文件</span><br>pyinstaller -F noPac.py<br> <br>加密打包exe（加密只针对依赖库）：<br>但是要安装tinyaes：pip install tinyaes<br>pyinstaller -F --key <span class="hljs-number">123456</span> xxx.py<br></code></pre></td></tr></table></figure>

<p>PYZ-00.pyz_extracted 文件夹里面为依赖库</p>
<h3 id="解密流程"><a href="#解密流程" class="headerlink" title="解密流程"></a><font style="color:rgb(0, 0, 0);">解密流程</font></h3><p><font style="color:rgb(0, 0, 0);">第一步，获取Crypto 的key，这是打包时由开发者指定的。解包完成后将在根目录形成名为”pyimod00_crypto_key.pyc”的文件，将它转为py文件即可查看key文件；</font></p>
<p>eg.iscc2025-re-看小品</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/10.png" srcset="/img/loading.gif" lazyload></p>
<p>重点就在这三个用pyinstxtractor.py解包后的pyc文件，something是源代码pyc</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/11.png" srcset="/img/loading.gif" lazyload></p>
<p>crypto_key会给出密钥</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/12.png" srcset="/img/loading.gif" lazyload></p>
<p>archive则关注Cipher类，会有加密方式和图示类，该类归属于package tinyaes</p>
<p>这里涉及pyinstaller版本问题</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/13.png" srcset="/img/loading.gif" lazyload></p>
<p>不同版本对应不同的解密脚本</p>
<h3 id="解密代码"><a href="#解密代码" class="headerlink" title="解密代码"></a>解密代码</h3><p>备注：解密后的内容写入创建的pyc文件时需要写入magic number等头文件信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">Python <span class="hljs-number">2.7</span>: \x03\xf3\x0d\x0a\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span><br>Python <span class="hljs-number">3.0</span>: \x3b\x0c\x0d\x0a\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span><br>Python <span class="hljs-number">3.1</span>: \x4f\x0c\x0d\x0a\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span><br>Python <span class="hljs-number">3.2</span>: \x6c\x0c\x0d\x0a\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span><br>Python <span class="hljs-number">3.3</span>: \x9e\x0c\x0d\x0a\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span><br>Python <span class="hljs-number">3.4</span>: \xee\x0c\x0d\x0a\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span><br>Python <span class="hljs-number">3.5</span>: \x17\x0d\x0d\x0a\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span><br>Python <span class="hljs-number">3.6</span>: \x33\x0d\x0d\x0a\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span><br>Python <span class="hljs-number">3.7</span>: \x42\x0d\x0d\x0a\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span><br>Python <span class="hljs-number">3.8</span>: \x55\x0d\x0d\x0a\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span><br>Python <span class="hljs-number">3.9</span>: \x61\x0d\x0d\x0a\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span><br>Python <span class="hljs-number">3.10</span>: \x6f\x0d\x0d\x0a\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span>\<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>

<p><font style="color:#000000;background-color:#FFFFFF;">pyinstaller &lt; 4.0</font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># For pyinstaller &lt; 4.0</span><br><span class="hljs-keyword">import</span> glob<br><span class="hljs-keyword">import</span> zlib<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br> <br>CRYPT_BLOCK_SIZE = <span class="hljs-number">16</span><br> <br><span class="hljs-comment"># key obtained from pyimod00_crypto_key</span><br>key = <span class="hljs-built_in">bytes</span>(<span class="hljs-string">&#x27;MySup3rS3cr3tK3y&#x27;</span>, <span class="hljs-string">&#x27;utf-8&#x27;</span>)<br> <br><span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> Path(<span class="hljs-string">&quot;PYZ-00.pyz_extracted&quot;</span>).glob(<span class="hljs-string">&quot;**/*.pyc.encrypted&quot;</span>):<br>	inf = <span class="hljs-built_in">open</span>(p, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-comment"># encrypted file input</span><br>	outf = <span class="hljs-built_in">open</span>(p.with_name(p.stem), <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-comment"># output file </span><br> <br>	<span class="hljs-comment"># Initialization vector</span><br>	iv = inf.read(CRYPT_BLOCK_SIZE)<br> <br>	cipher = AES.new(key, AES.MODE_CFB, iv)<br> <br>	<span class="hljs-comment"># Decrypt and decompress</span><br>	plaintext = zlib.decompress(cipher.decrypt(inf.read()))<br> <br>	<span class="hljs-comment"># Write pyc header</span><br>	<span class="hljs-comment"># The header below is for Python 3.8</span><br>	outf.write(<span class="hljs-string">b&#x27;\x55\x0d\x0d\x0a\0\0\0\0\0\0\0\0\0\0\0\0&#x27;</span>)<br> <br>	<span class="hljs-comment"># Write decrypted data</span><br>	outf.write(plaintext)<br> <br>	inf.close()<br>	outf.close()<br> <br>	<span class="hljs-comment"># Delete .pyc.encrypted file</span><br>	p.unlink()<br></code></pre></td></tr></table></figure>

<p><font style="color:#000000;background-color:#FFFFFF;">版本&gt;&#x3D; 4.0</font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># For pyinstaller &gt;=4.0</span><br><span class="hljs-keyword">import</span> glob<br><span class="hljs-keyword">import</span> zlib<br><span class="hljs-keyword">import</span> tinyaes<br><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br> <br>CRYPT_BLOCK_SIZE = <span class="hljs-number">16</span><br> <br><span class="hljs-comment"># key obtained from pyimod00_crypto_key</span><br>key = <span class="hljs-built_in">bytes</span>(<span class="hljs-string">&#x27;MySup3rS3cr3tK3y&#x27;</span>, <span class="hljs-string">&#x27;utf-8&#x27;</span>)<br> <br><span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> Path(<span class="hljs-string">&quot;PYZ-00.pyz_extracted&quot;</span>).glob(<span class="hljs-string">&quot;**/*.pyc.encrypted&quot;</span>):<br>	inf = <span class="hljs-built_in">open</span>(p, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-comment"># encrypted file input</span><br>	outf = <span class="hljs-built_in">open</span>(p.with_name(p.stem), <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-comment"># output file </span><br> <br>	<span class="hljs-comment"># Initialization vector</span><br>	iv = inf.read(CRYPT_BLOCK_SIZE)<br> <br>	cipher = tinyaes.AES(key, iv)<br> <br>	<span class="hljs-comment"># Decrypt and decompress</span><br>	plaintext = zlib.decompress(cipher.CTR_xcrypt_buffer(inf.read()))<br> <br>	<span class="hljs-comment"># Write pyc header</span><br>	<span class="hljs-comment"># The header below is for Python 3.8</span><br>	outf.write(<span class="hljs-string">b&#x27;\x55\x0d\x0d\x0a\0\0\0\0\0\0\0\0\0\0\0\0&#x27;</span>)<br> <br>	<span class="hljs-comment"># Write decrypted data</span><br>	outf.write(plaintext)<br> <br>	inf.close()<br>	outf.close()<br> <br>	<span class="hljs-comment"># Delete .pyc.encrypted file</span><br>	p.unlink()<br></code></pre></td></tr></table></figure>

<h1 id="TEA加密解密"><a href="#TEA加密解密" class="headerlink" title="TEA加密解密"></a>TEA加密解密</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>网上相关算法介绍有很多，就不过多赘述了，一段话带过</p>
<p><font style="color:#000000;background-color:#FFFFFF;">TEA加密解密是以原文以8字节（64位bit）为一组，密钥16字节（128位bit）为一组，（char为1字节，int为4字节，double为8字节），该算法加密轮次可变，作者建议为32轮，因为被加密的明文为64位，所以最终加密的结果也是64位。</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">unsigned int key[4]=&#123;0x00010203,0x04050607,0x08090a0b,0x0c0d0e0f&#125;; //int四字节 4*8=32<br>unsigned int v1[2] = &#123;0xaabbccdd,0x01234567&#125;;   //明文64位，密钥128位<br></code></pre></td></tr></table></figure>

<p><font style="color:#000000;background-color:#FFFFFF;">重点关注算法的delta，sum，key，以及明密文</font></p>
<p><font style="color:#000000;background-color:#FFFFFF;">该算法使用了一个神秘常数δ作为倍数，它来源于黄金比率，以保证每一轮加密都不相同。但δ的精确值似乎并不重要，这里TEA把它定义为 δ&#x3D;「(√5 - 1)231」，这个δ对应的数指就是0×9E3779B9，也就是delta的值。</font></p>
<p><font style="color:#000000;background-color:#FFFFFF;">如下是一个示例参考代码</font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> struct<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">plaintext, key</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    TEA 加密函数</span><br><span class="hljs-string">    :param plaintext: 8字节明文字符串</span><br><span class="hljs-string">    :param key: 16字节密钥字符串</span><br><span class="hljs-string">    :return: 8字节密文字符串</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 将输入拆分为两个32位整数</span><br>    v0, v1 = struct.unpack(<span class="hljs-string">&quot;&gt;2I&quot;</span>, plaintext)<br>    <br>    <span class="hljs-comment"># 将密钥拆分为四个32位整数</span><br>    k = struct.unpack(<span class="hljs-string">&quot;&gt;4I&quot;</span>, key)<br>    <br>    <span class="hljs-comment"># 初始化常量</span><br>    delta = <span class="hljs-number">0x9E3779B9</span><br>    sum_val = <span class="hljs-number">0</span><br>    <br>    <span class="hljs-comment"># 进行32轮加密</span><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>        sum_val = (sum_val + delta) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>        v0 += ((v1 &lt;&lt; <span class="hljs-number">4</span>) + k[<span class="hljs-number">0</span>]) ^ (v1 + sum_val) ^ ((v1 &gt;&gt; <span class="hljs-number">5</span>) + k[<span class="hljs-number">1</span>])<br>        v0 &amp;= <span class="hljs-number">0xFFFFFFFF</span><br>        v1 += ((v0 &lt;&lt; <span class="hljs-number">4</span>) + k[<span class="hljs-number">2</span>]) ^ (v0 + sum_val) ^ ((v0 &gt;&gt; <span class="hljs-number">5</span>) + k[<span class="hljs-number">3</span>])<br>        v1 &amp;= <span class="hljs-number">0xFFFFFFFF</span><br>    <br>    <span class="hljs-comment"># 返回拼接后的密文</span><br>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;&gt;2I&quot;</span>, v0, v1)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">ciphertext, key</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    TEA 解密函数</span><br><span class="hljs-string">    :param ciphertext: 8字节密文字符串</span><br><span class="hljs-string">    :param key: 16字节密钥字符串</span><br><span class="hljs-string">    :return: 8字节明文字符串</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 将输入拆分为两个32位整数</span><br>    v0, v1 = struct.unpack(<span class="hljs-string">&quot;&gt;2I&quot;</span>, ciphertext)<br>    <br>    <span class="hljs-comment"># 将密钥拆分为四个32位整数</span><br>    k = struct.unpack(<span class="hljs-string">&quot;&gt;4I&quot;</span>, key)<br>    <br>    <span class="hljs-comment"># 初始化常量</span><br>    delta = <span class="hljs-number">0x9E3779B9</span><br>    sum_val = (delta * <span class="hljs-number">32</span>) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    <br>    <span class="hljs-comment"># 进行32轮解密</span><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>        v1 -= ((v0 &lt;&lt; <span class="hljs-number">4</span>) + k[<span class="hljs-number">2</span>]) ^ (v0 + sum_val) ^ ((v0 &gt;&gt; <span class="hljs-number">5</span>) + k[<span class="hljs-number">3</span>])<br>        v1 &amp;= <span class="hljs-number">0xFFFFFFFF</span><br>        v0 -= ((v1 &lt;&lt; <span class="hljs-number">4</span>) + k[<span class="hljs-number">0</span>]) ^ (v1 + sum_val) ^ ((v1 &gt;&gt; <span class="hljs-number">5</span>) + k[<span class="hljs-number">1</span>])<br>        v0 &amp;= <span class="hljs-number">0xFFFFFFFF</span><br>        sum_val = (sum_val - delta) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    <br>    <span class="hljs-comment"># 返回拼接后的明文</span><br>    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;&gt;2I&quot;</span>, v0, v1)<br><br><span class="hljs-comment"># 测试代码</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># 测试密钥 (16字节)</span><br>    key = <span class="hljs-string">b&quot;1234567890abcdef&quot;</span><br>    <br>    <span class="hljs-comment"># 测试明文 (8字节)</span><br>    plaintext = <span class="hljs-string">b&quot;ABCDabcd&quot;</span><br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;原始明文:&quot;</span>, plaintext)<br>    <br>    <span class="hljs-comment"># 加密</span><br>    ciphertext = encrypt(plaintext, key)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;加密结果:&quot;</span>, ciphertext.<span class="hljs-built_in">hex</span>())<br>    <br>    <span class="hljs-comment"># 解密</span><br>    decrypted = decrypt(ciphertext, key)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;解密结果:&quot;</span>, decrypted)<br>    <br>    <span class="hljs-comment"># 验证</span><br>    <span class="hljs-keyword">assert</span> decrypted == plaintext, <span class="hljs-string">&quot;解密结果与原始明文不匹配&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;验证成功: 解密结果与原始明文一致&quot;</span>)<br></code></pre></td></tr></table></figure>

<h2 id="逆向"><a href="#逆向" class="headerlink" title="逆向"></a><font style="color:#000000;background-color:#FFFFFF;">逆向</font></h2><p><font style="color:#000000;">介绍一个ida插件findcrypto，具体原理是识别对应加密算法特征字样，在魔改环境中收效甚微</font></p>
<p><font style="color:rgb(0, 0, 0);">这里用findcypto插件来进行识别测试，0x9e3779b9特征码被识别</font></p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/14.png" srcset="/img/loading.gif" lazyload></p>
<p>其实看出tea算法不难，当初鄙人主要卡在unsigned int 之类的变量类型上导致不会写解密代码</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/15.png" srcset="/img/loading.gif" lazyload></p>
<p>上图即逆向过程中遇到的实际加密过程呈现，32轮，对应sum，delta和两个变量</p>
<p>这里总结了下ida以及C语言等的变量类型，主要是不同平台和语言导致的一些细节处理</p>
<h3 id="int类"><a href="#int类" class="headerlink" title="_int类"></a>_int类</h3><p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/16.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="unsigned-int"><a href="#unsigned-int" class="headerlink" title="unsigned int"></a>unsigned int</h3><p>unsigned int 和 signed int  Eg. 00000000   0 | 0000000 (方便理解，实际unsigned int 为四字节32位)</p>
<p>主要就是最高位符号位，前者un不考虑符号位，8位用于0-2^8-1，后者1位符号位，1表示负数，0表示正数，剩余七位表示数字大小</p>
<h3 id="uint类"><a href="#uint类" class="headerlink" title="uint类"></a>uint类</h3><p>主要有uint8_t &#x2F; uint16_t &#x2F; uint32_t &#x2F; uint64_t</p>
<p>由 C99标准（ISO&#x2F;IEC 9899:1999） 引入，在头文件 &lt;stdint.h&gt; 中定义（C++中可包含<cstdint>）。</p>
<p>定义原理：通过typedef将基础类型映射到固定宽度的别名，具体实现依赖编译器和平台</p>
<p>这些是C&#x2F;C++标准中定义的固定宽度的无符号整数类型别名，通过typedef实现。</p>
<p>它们明确指定了整数的位宽度：</p>
<p>uint8_t：精确占用 8位 的无符号整数</p>
<p>uint16_t：精确占用 16位 的无符号整数</p>
<p>uint32_t：精确占用 32位 的无符号整数</p>
<p>uint64_t：精确占用 64位 的无符号整数</p>
<p>核心作用：</p>
<p>提供跨平台的一致性。不同硬件&#x2F;编译器的基础类型（如int、long的大小可能不同），而uintX_t能确保在任何平台上宽度固定，适合底层编程（如网络协议、硬件寄存器操作）。</p>
<p>有符号版本：int8_t, int16_t, int32_t, int64_t   参考_int类</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>编写解密代码更推荐用C语言，用python会出现一些精度问题</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">uint32_t</span> v[<span class="hljs-number">2</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;;<br>    <span class="hljs-type">uint32_t</span> v0 = v[<span class="hljs-number">0</span>], v1 = v[<span class="hljs-number">1</span>], sum, i; <span class="hljs-comment">/* set up */</span><br>    <span class="hljs-type">uint32_t</span> delta = <span class="hljs-number">0x61C88647</span>;<br>    <span class="hljs-type">uint32_t</span> v5[<span class="hljs-number">10</span>] = &#123;<span class="hljs-number">0x85336dd3</span>,<span class="hljs-number">0x2a7a7c3b</span>,<span class="hljs-number">0x64306238</span>,<span class="hljs-number">0x36396434</span>,<span class="hljs-number">0x62336364</span>,<span class="hljs-number">0x38376533</span>,<span class="hljs-number">0x37323664</span>,<span class="hljs-number">0x33363463</span>,<span class="hljs-number">0xf8ee8ea2</span>,<span class="hljs-number">0xc9b65cce</span>&#125;;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> k[<span class="hljs-number">4</span>] = &#123;<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">4</span>&#125;, l = <span class="hljs-number">0</span>, r = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">uint32_t</span> k0 = k[<span class="hljs-number">0</span>], k1 = k[<span class="hljs-number">1</span>], k2 = k[<span class="hljs-number">2</span>], k3 = k[<span class="hljs-number">3</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> m = <span class="hljs-number">0</span>; m &lt; <span class="hljs-number">10</span>; m += <span class="hljs-number">2</span>) &#123;<br>        sum = delta*(<span class="hljs-number">-32</span>);<br>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) &#123; <br>            v5[m + <span class="hljs-number">1</span>] -= ((v5[m] &lt;&lt; <span class="hljs-number">4</span>) + k2) ^ (v5[m] + sum) ^ ((v5[m] &gt;&gt; <span class="hljs-number">5</span>) + k3);<br>            v5[m] -= ((v5[m + <span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">4</span>) + k0) ^ (v5[m + <span class="hljs-number">1</span>] + sum) ^ ((v5[m + <span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">5</span>) + k1);<br>            sum += delta;<br>        &#125; <br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> m = <span class="hljs-number">0</span>; m &lt;= <span class="hljs-number">3</span>; m++) &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, (v5[i] &gt;&gt; (<span class="hljs-number">8</span> * m)) &amp; <span class="hljs-number">0xff</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>明密文是32位32位取的，两位为一组，32轮循环只是其中的一轮加密，重点关注明密文存取的对应代码块，有些是1 2 3 4俩俩一组，有些则是1 2 2 3这样有关联的分组，还有些是按其顺序倒序解密</p>
<h2 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h2><p>涉及到xtea和xxtea算法了，这里仅对后两者特征做一个介绍</p>
<p>xtea为tea的升级版，摒弃了 TEA 固定循环使用密钥的方式，引入了一个更复杂的密钥生成函数。子密钥不再是直接从密钥数组中按固定顺序取出，而是根据当前的轮次 i 和部分明文（通常是 sum 的值）动态计算出来：</p>
<p>( (sum &gt;&gt; 11) &amp; 3 )</p>
<p>这个值用于索引密钥数组 K[0..3]，然后结合 sum 和密钥 K[index] 计算出该轮实际使用的子密钥 Delta。</p>
<p>xxtea则是拓展版，用于解决tea系列加密的分组大小限制，但是受选择明文攻击威胁</p>
<p>以下是两种算法代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">encipher</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> num_rounds, <span class="hljs-type">uint32_t</span> v[<span class="hljs-number">2</span>], <span class="hljs-type">uint32_t</span> <span class="hljs-type">const</span> key[<span class="hljs-number">4</span>])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i;<br>    <span class="hljs-type">uint32_t</span> v0=v[<span class="hljs-number">0</span>], v1=v[<span class="hljs-number">1</span>], sum=<span class="hljs-number">0</span>, delta=<span class="hljs-number">0x9E3779B9</span>;<br>    <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i &lt; num_rounds; i++) &#123;<br>        v0 += (((v1 &lt;&lt; <span class="hljs-number">4</span>) ^ (v1 &gt;&gt; <span class="hljs-number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="hljs-number">3</span>]);<br>        sum += delta;<br>        v1 += (((v0 &lt;&lt; <span class="hljs-number">4</span>) ^ (v0 &gt;&gt; <span class="hljs-number">5</span>)) + v0) ^ (sum + key[(sum&gt;&gt;<span class="hljs-number">11</span>) &amp; <span class="hljs-number">3</span>]);<br>    &#125;<br>    v[<span class="hljs-number">0</span>]=v0; v[<span class="hljs-number">1</span>]=v1;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">decipher</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> num_rounds, <span class="hljs-type">uint32_t</span> v[<span class="hljs-number">2</span>], <span class="hljs-type">uint32_t</span> <span class="hljs-type">const</span> key[<span class="hljs-number">4</span>])</span> </span>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i;<br>    <span class="hljs-type">uint32_t</span> v0=v[<span class="hljs-number">0</span>], v1=v[<span class="hljs-number">1</span>], delta=<span class="hljs-number">0x9E3779B9</span>, sum=delta*num_rounds;<br>    <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i &lt; num_rounds; i++) &#123;<br>        v1 -= (((v0 &lt;&lt; <span class="hljs-number">4</span>) ^ (v0 &gt;&gt; <span class="hljs-number">5</span>)) + v0) ^ (sum + key[(sum&gt;&gt;<span class="hljs-number">11</span>) &amp; <span class="hljs-number">3</span>]);<br>        sum -= delta;<br>        v0 -= (((v1 &lt;&lt; <span class="hljs-number">4</span>) ^ (v1 &gt;&gt; <span class="hljs-number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="hljs-number">3</span>]);<br>    &#125;<br>    v[<span class="hljs-number">0</span>]=v0; v[<span class="hljs-number">1</span>]=v1;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">uint32_t</span> v[<span class="hljs-number">2</span>]=&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>&#125;;<br>    <span class="hljs-type">uint32_t</span> <span class="hljs-type">const</span> k[<span class="hljs-number">4</span>]=&#123;<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>&#125;;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r=<span class="hljs-number">32</span>;<span class="hljs-comment">//num_rounds建议取值为32// v为要加密的数据是两个32位无符号整数// k为加密解密密钥，为4个32位无符号整数，即密钥长度为128位</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;加密前原始数据：%u %u\n&quot;</span>,v[<span class="hljs-number">0</span>],v[<span class="hljs-number">1</span>]);<br>    <span class="hljs-built_in">encipher</span>(r, v, k);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;加密后的数据：%u %u\n&quot;</span>,v[<span class="hljs-number">0</span>],v[<span class="hljs-number">1</span>]);<br>    <span class="hljs-built_in">decipher</span>(r, v, k);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;解密后的数据：%u %u\n&quot;</span>,v[<span class="hljs-number">0</span>],v[<span class="hljs-number">1</span>]);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> DELTA 0x9e3779b9</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MX (((z&gt;&gt;5^y<span class="hljs-string">&lt;&lt;2) + (y&gt;</span>&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">btea</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> *v, <span class="hljs-type">int</span> n, <span class="hljs-type">uint32_t</span> <span class="hljs-type">const</span> key[<span class="hljs-number">4</span>])</span> </span>&#123;<br>    <span class="hljs-type">uint32_t</span> y, z, sum;<br>    <span class="hljs-type">unsigned</span> p, rounds, e;<br>    <span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">1</span>) &#123;         <br>        rounds = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> / n;<br>        sum = <span class="hljs-number">0</span>;<br>        z = v[n - <span class="hljs-number">1</span>];<br>        <span class="hljs-keyword">do</span> &#123;<br>            sum += DELTA;<br>            e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>            <span class="hljs-keyword">for</span> (p = <span class="hljs-number">0</span>; p &lt; n - <span class="hljs-number">1</span>; p++) &#123;<br>                y = v[p + <span class="hljs-number">1</span>];<br>                z = v[p] += MX;<br>            &#125;<br>            y = v[<span class="hljs-number">0</span>];<br>            z = v[n - <span class="hljs-number">1</span>] += MX;<br>        &#125; <span class="hljs-keyword">while</span> (--rounds);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">-1</span>) &#123;  <br>        n = -n;<br>        rounds = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> / n;<br>        sum = rounds * DELTA;<br>        y = v[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">do</span> &#123;<br>            e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>            <span class="hljs-keyword">for</span> (p = n - <span class="hljs-number">1</span>; p &gt; <span class="hljs-number">0</span>; p--) &#123;<br>                z = v[p - <span class="hljs-number">1</span>];<br>                y = v[p] -= MX;<br>            &#125;<br>            z = v[n - <span class="hljs-number">1</span>];<br>            y = v[<span class="hljs-number">0</span>] -= MX;<br>            sum -= DELTA;<br>        &#125; <span class="hljs-keyword">while</span> (--rounds);<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">uint32_t</span> v[<span class="hljs-number">9</span>] = &#123;<span class="hljs-number">0x78e1f564</span>,<span class="hljs-number">0xa835f0e1</span>,<span class="hljs-number">0x512ff34</span>,<span class="hljs-number">0xb0e913fb</span>,<span class="hljs-number">0x89b9a350</span>,<span class="hljs-number">0xc943dab1</span>,<span class="hljs-number">0x1dbc84f</span>,<span class="hljs-number">0xaf16db20</span>,<span class="hljs-number">0x961767ed</span>&#125;;<br>    <span class="hljs-type">uint32_t</span> <span class="hljs-type">const</span> k[<span class="hljs-number">4</span>] = &#123;<span class="hljs-number">0x63656f6d</span>,<span class="hljs-number">0x30326674</span>,<span class="hljs-number">0x21213432</span>,<span class="hljs-number">0xCCFFBBBB</span>&#125;;<br>    <span class="hljs-type">int</span> n = <span class="hljs-number">9</span>;<br>    <span class="hljs-built_in">btea</span>(v, -n, k);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">9</span>; i ++) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, v[i] &amp; <span class="hljs-number">0xff</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, v[i] &gt;&gt; <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, v[i] &gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, v[i] &gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> DELTA 0x61C88646</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MX (((z &gt;&gt; 5 ^ y <span class="hljs-string">&lt;&lt; 2) + (y &gt;</span>&gt; 3 ^ z &lt;&lt; 4)) ^ ((sum ^ y) + (key[(p &amp; 3) ^ e] ^ z)))</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">xxtea</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> *v, <span class="hljs-type">int</span> n, <span class="hljs-type">uint32_t</span> <span class="hljs-type">const</span> key[<span class="hljs-number">4</span>])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">uint32_t</span> y, z, sum;<br>    <span class="hljs-type">unsigned</span> p, rounds, e;<br>    <span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">1</span>) <span class="hljs-comment">/* Coding Part */</span><br>    &#123;<br>        rounds = <span class="hljs-number">7</span>;<br>        sum = <span class="hljs-number">0</span>;<br>        z = v[n - <span class="hljs-number">1</span>];<br>        <span class="hljs-keyword">do</span><br>        &#123;<br>            sum += DELTA;<br>            e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>            <span class="hljs-keyword">for</span> (p = <span class="hljs-number">0</span>; p &lt; n - <span class="hljs-number">1</span>; p++)<br>            &#123;<br>                y = v[p + <span class="hljs-number">1</span>];<br>                z = v[p] += MX;<br>                <span class="hljs-keyword">if</span> (z == <span class="hljs-number">0xA4F41487</span>)<br>                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;11\n&quot;</span>);<br>                <span class="hljs-keyword">if</span> (y == <span class="hljs-number">0xA4F41487</span>)<br>                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;11\n&quot;</span>);<br>            &#125;<br>            y = v[<span class="hljs-number">0</span>];<br>            z = v[n - <span class="hljs-number">1</span>] += MX;<br><br>        &#125; <span class="hljs-keyword">while</span> (--rounds);<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">-1</span>) <span class="hljs-comment">/* Decoding Part */</span><br>    &#123;<br>        n = -n;<br>        rounds = <span class="hljs-number">7</span>;<br>        sum = rounds * DELTA;<br>        y = v[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">do</span><br>        &#123;<br>            e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>            <span class="hljs-keyword">for</span> (p = n - <span class="hljs-number">1</span>; p &gt; <span class="hljs-number">0</span>; p--)<br>            &#123;<br>                z = v[p - <span class="hljs-number">1</span>];<br>                y = v[p] -= MX;<br>            &#125;<br>            z = v[n - <span class="hljs-number">1</span>];<br>            y = v[<span class="hljs-number">0</span>] -= MX;<br>            sum -= DELTA;<br>        &#125; <span class="hljs-keyword">while</span> (--rounds);<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">srand</span>(<span class="hljs-number">0xAABB</span>);<br>    <span class="hljs-type">uint32_t</span> key[<span class="hljs-number">4</span>]&#123;&#125;;<br>    <span class="hljs-type">uint32_t</span> Enc[]&#123;<br>        <span class="hljs-number">0xa9934e2f</span>, <span class="hljs-number">0x30b90fa</span>, <span class="hljs-number">0xdcbf1d3</span>, <span class="hljs-number">0x328b5bde</span>,<br>        <span class="hljs-number">0x44fab4e</span>, <span class="hljs-number">0x1dcf0051</span>, <span class="hljs-number">0x85ebbe55</span>, <span class="hljs-number">0x93aa773a</span>&#125;;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)<br>    &#123;<br>        key[i] = <span class="hljs-built_in">rand</span>();<br>    &#125;<br>    <span class="hljs-built_in">xxtea</span>(Enc, <span class="hljs-number">-8</span>, key);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%.32s\n&quot;</span>, Enc);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="花指令"><a href="#花指令" class="headerlink" title="花指令"></a>花指令</h1><p>这一块原理比较好掌握，但是具体操作还是多接触样例进步得快</p>
<h2 id="什么是花指令"><a href="#什么是花指令" class="headerlink" title="什么是花指令?"></a>什么是花指令?</h2><p>花指令实质就是一串垃圾指令，它与程序本身的功能无关，并不影响程序本身的逻辑。在软件保护中，花指令被作为一种手段来增加静态分析的难度，花指令也可以被用在病毒或木马上，通过加入花指令改变程序的特征码，躲避杀软的扫描，从而达到免杀的目的，本文将介绍一些常见的花指令的形式，花指令一般被分为两类，被执行的和不会被执行的。</p>
<h2 id="不会被执行的花指令"><a href="#不会被执行的花指令" class="headerlink" title="不会被执行的花指令"></a>不会被执行的花指令</h2><p>花指令虽然被插入到了正常代码的中间，但是并不意味着它一定会得到执行，这类花指令通常形式为在代码中出现了类似数据的代码，或者IDA反汇编后为jmupout(xxxxx).</p>
<p>这类花指令一般不属于CPU可以识别的操作码，那么就需要在上面用跳转跳过这些花指令才能保证程序的正常运行。</p>
<h2 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_51246873/article/details/127167749">https://blog.csdn.net/m0_51246873&#x2F;article&#x2F;details&#x2F;127167749</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/YenKoc/p/14136012.html">https://www.cnblogs.com/YenKoc/p/14136012.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.xjx100.cn/news/40167.html?action=onClick">https://www.xjx100.cn/news/40167.html?action=onClick</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/MUth1Qw-Fl2a5OrLw_2_0g">https://mp.weixin.qq.com/s/MUth1Qw-Fl2a5OrLw_2_0g</a></p>
<p>+j1ya✌的教学和xk老师博客的参考</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>反汇编引擎主要有两种算法，一种是线性扫描算法，一种是递归行进算法。</p>
<p>线性扫描算法将遇到的每一条指令都解析成汇编指令，没有对反汇编的内容进行判断，因而无法正确区分代码和数据，一些数据也会被当成代码来解码，从而导致反汇编出现错误，这种错误将会影响对下一条指令的正确识别。</p>
<p>递归行进算法按照代码可能的执行顺序来反汇编程序，对每条可能的路径进行扫描，当解码出分支指令后，反汇编工具就将这么地址记录下来，并分别反汇编各个分支中的指令，这种算法比较灵活，可以避免将代码中的数据作为指令来解码。</p>
<ul>
<li>线性扫描算法：逐行反汇编（无法将数据和内容进行区分）</li>
<li>递归行进算法：按照代码可能的执行顺序进行反汇编程序。（难以准确定位）</li>
</ul>
<p>正是因为这两种反汇编的规格和缺陷机制，所以才导致了会有花指令的诞生。</p>
<p>ida是线性扫描，动调的时候能f4跳过循环就是这个道理，正是因为线性导致程序结构混乱的时候会无法反编译</p>
<p>花指令简单的说就是在代码中混入一些垃圾数据阻碍你的静态分析</p>
<p>要么可执行不改变值，要么反汇编后为jumpout(xxxxx)，需要在上面用跳转跳过这些花指令才能保证程序的正常运行。</p>
<hr>
<p>反汇编错误通常会有三个特征</p>
<p>1.call目的地址畸形</p>
<p>2.跳转到某条指令的中间,IDA中形如地址+x的样子</p>
<p>3.大量不常见、不合理的指令(由于反汇编错位而出现)</p>
<h2 id="常见指令"><a href="#常见指令" class="headerlink" title="常见指令"></a>常见指令</h2><ul>
<li><font style="color:rgba(0, 0, 0, 0.9);">0xE8 call + 4字节偏移地址</font></li>
<li><font style="color:rgba(0, 0, 0, 0.9);">0xE9 jmp + 4字节偏移地址</font></li>
<li><font style="color:rgba(0, 0, 0, 0.9);">0xEB jmp + 2字节偏移地址</font></li>
<li><font style="color:rgba(0, 0, 0, 0.9);">0xFF15 call + 4字节地址</font></li>
<li><font style="color:rgba(0, 0, 0, 0.9);">0xFF25 jmp + 4字节地址</font></li>
<li><font style="color:rgba(0, 0, 0, 0.9);">0xcc int 3</font></li>
<li><font style="color:rgba(0, 0, 0, 0.9);">0xe2 loop</font></li>
<li><font style="color:rgba(0, 0, 0, 0.9);">0x0f84 jz</font></li>
<li><font style="color:rgba(0, 0, 0, 0.9);">0x0f85 jnz</font></li>
</ul>
<h2 id="具体例子"><a href="#具体例子" class="headerlink" title="具体例子"></a>具体例子</h2><h3 id="1-简单jmp"><a href="#1-简单jmp" class="headerlink" title="1.简单jmp"></a>1.简单jmp</h3><p>OD能被骗过去，但是因为ida采用的是递归扫描的办法所以能够正常识别。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp">start:<span class="hljs-comment">//花指令开始</span><br>    jmp label1<br>    DB junkcode<br>label1:<br>     jmp label2<br>     DB junkcode<br>label2：<br>    jmp label3<br>    DB junkcode<br>label3   <br></code></pre></td></tr></table></figure>

<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/17.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="2-jx-jnx（x可为e-z-l）"><a href="#2-jx-jnx（x可为e-z-l）" class="headerlink" title="2.jx+jnx（x可为e,z,l）"></a>2.jx+jnx（x可为e,z,l）</h3><p>第一种为替代jmp指令</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp">_asm&#123;<br>    jz label1<br>    jnz label1<br>    db junkcode<br>label1:    <br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/18.png" srcset="/img/loading.gif" lazyload></p>
<p>第二种用于永真条件跳转</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp">__asm&#123;<br>    push ebx<br>    <span class="hljs-keyword">xor</span> ebx,ebx<br>    test ebx,ebx<br>    jnz label1<br>    jz label2<br>label1:<br>    _emit junkcode<br>label2:<br>   pop ebx<span class="hljs-comment">//需要恢复ebx寄存器    </span><br>&#125;<br><br>__asm&#123;<br>	clc<br>	jnz label1:<br>	_emit junkcode<br>label1:<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/19.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="3-call-add-esp，4或call-add-esp-n-retn"><a href="#3-call-add-esp，4或call-add-esp-n-retn" class="headerlink" title="3.call +add esp，4或call + add [esp], n + retn"></a>3.call +add esp，4或call + add [esp], n + retn</h3><p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/20.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/21.png" srcset="/img/loading.gif" lazyload></p>
<p>这里call指令，其实本质就是jmp&amp;push 下一条指令的地址，但是这里其实就是一个jmp指令，所以push这条指令是多余的，需要add esp,4 调整堆栈，但是ida会默认把call 后面的那个地址当成一个函数</p>
<h3 id="4-jmp-XXX（红色）"><a href="#4-jmp-XXX（红色）" class="headerlink" title="4.jmp XXX（红色）"></a>4.jmp XXX（红色）</h3><p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/22.png" srcset="/img/loading.gif" lazyload></p>
<p>可以看到一串爆红的地址，但是虚拟地址不可能那么大，以下是花指令源代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">asm</span> &#123;<br>    _emit <span class="hljs-number">075</span>h   <span class="hljs-meta">#jmp $+4</span><br>    _emit <span class="hljs-number">2</span>h    <br>    _emit <span class="hljs-number">0E9</span>h <br>    _emit <span class="hljs-number">0</span>EDh    <br>&#125;<br></code></pre></td></tr></table></figure>

<p>E9是jmp指令对应的机器码,当反汇编器读取到E9时,接着会往下读取四个字节的数据作为跳转地址的偏移,所以才会看到错误的汇编代码。ida会默认将e9后面的4个字节当成地址，导致出现上述情况，nop掉jmp(E9)即可</p>
<h3 id="5-call-ret"><a href="#5-call-ret" class="headerlink" title="5.call+ret"></a>5.call+ret</h3><p>凌武杯2023 flower_tea</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/23.png" srcset="/img/loading.gif" lazyload></p>
<p>NCTF2024 ezDOS</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/24.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="6-stx-jx"><a href="#6-stx-jx" class="headerlink" title="6.stx&#x2F;jx"></a>6.stx&#x2F;jx</h3><p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/25.png" srcset="/img/loading.gif" lazyload></p>
<p>clc是清除EFlags寄存器的carry位的标志，而jnb是根据cf&#x3D;&#x3D;0时跳转的，然而jnb这个分支指令，ida又将后面的部分认作成了另外的分支。</p>
<h2 id="去花"><a href="#去花" class="headerlink" title="去花"></a>去花</h2><p>刚好有人提问，就借着这道例题( <strong><font style="color:rgb(0, 0, 0);">[MoeCTF 2022]chicken_soup</font></strong><font style="color:rgb(0, 0, 0);"> </font>)讲解过程</p>
<p><font style="color:rgb(0, 0, 0);">首先介绍下前提操作知识点</font></p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/26.png" srcset="/img/loading.gif" lazyload></p>
<p>patch program下有个nop，用于将机器码注销，值为90，各版本ida快捷键等不同</p>
<p>用于去除不需要的汇编代码</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/27.png" srcset="/img/loading.gif" lazyload></p>
<p>图二为找到的花指令位置，图一的u将汇编码内容取消定义恢复成机器码(框出部分)，c将对应机器码分析成汇编代码，p则在function里用于创建函数(function里也可以设定函数结束地址，一些特定情况需要用到，我的ida9里对应快捷键没有设置，对应E键)</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/28.png" srcset="/img/loading.gif" lazyload></p>
<p>上图为u后效果，至于如何在ida里显示机器码</p>
<p>option-&gt;general</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/29.png" srcset="/img/loading.gif" lazyload></p>
<p>红色为机器码，蓝框左为显示函数地址，用于堆栈指针复原，方便sp(stack pointer)分析</p>
<p><strong><font style="color:rgb(38, 38, 38);">[网鼎杯 2020 青龙组]jocker</font></strong></p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/30.png" srcset="/img/loading.gif" lazyload></p>
<p>修改负值为0即可，这里了解即可</p>
<p>蓝框右推荐打开，帮助分析汇编代码并注释</p>
<p>想永久保存设置的话需到ida.cfg文件里去修改对应内容</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/31.png" srcset="/img/loading.gif" lazyload></p>
<p>回到题目上</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/32.png" srcset="/img/loading.gif" lazyload></p>
<p>永真跳转，jmp一个大地址，两处一样，nop永真判断，nop jmp对应的E9</p>
<p>nop e9 : 在jmp处u</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/33.png" srcset="/img/loading.gif" lazyload></p>
<p>再单独nop，然后在对应标签处p创建函数，两处操作一样</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/34.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/35.png" srcset="/img/loading.gif" lazyload></p>
<p>至此，去花完毕</p>
<p><img src="/2025/07/26/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83(%E4%BA%8C)/36.png" srcset="/img/loading.gif" lazyload></p>
<p>主要是针对两个函数做了混淆</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Reverse/" class="category-chain-item">Reverse</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Reverse入门参考(二)</div>
      <div>https://alenirving.github.io/2025/07/26/Reverse入门参考(二)/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Ma5k</div>
        </div>
      
      
      
        <div class="license-meta-item license-meta-date">
          <div>更新于</div>
          <div>2025年7月26日</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              CC-BY-NC-SA
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/08/30/idapython_study/" title="idapython_study">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">idapython_study</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/07/19/Reverse%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83/" title="Reverse入门参考">
                        <span class="hidden-mobile">Reverse入门参考</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  



  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
